<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="賞味期限をガントチャート形式で管理するアプリ">
    <meta name="theme-color" content="#FF6B6B">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Freshly">
    <title>Freshly - 賞味期限トラッカー</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/gantt.css">
    <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
    <div class="container">
        <!-- Header (Compact) -->
        <header class="header">
            <h1 class="header-title">Freshly</h1>
            <button id="toggleFiltersBtn" class="btn-filter-toggle" aria-label="検索・フィルター">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="11" cy="11" r="8"></circle>
                    <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                </svg>
            </button>
        </header>

        <!-- Search and Filter Section (Collapsible) -->
        <section class="controls collapsed" id="controlsSection">
            <div class="search-wrapper">
                <input
                    type="text"
                    id="searchInput"
                    class="search-input"
                    placeholder="名前で検索..."
                    aria-label="アイテムを検索"
                >
            </div>

            <div class="filters">
                <div class="filter-group">
                    <label for="categoryFilter" class="filter-label">カテゴリー:</label>
                    <select id="categoryFilter" class="filter-select" aria-label="カテゴリーでフィルター">
                        <option value="">すべて</option>
                        <option value="お菓子">お菓子</option>
                        <option value="肉類">肉類</option>
                        <option value="魚介類">魚介類</option>
                        <option value="乳製品・卵">乳製品・卵</option>
                        <option value="野菜">野菜</option>
                        <option value="果物">果物</option>
                        <option value="穀物・麺類">穀物・麺類</option>
                        <option value="缶詰">缶詰</option>
                        <option value="調味料">調味料</option>
                        <option value="飲料">飲料</option>
                        <option value="その他">その他</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="statusFilter" class="filter-label">ステータス:</label>
                    <select id="statusFilter" class="filter-select" aria-label="ステータスでフィルター">
                        <option value="">すべて</option>
                        <option value="fresh">新鮮（8日以上）</option>
                        <option value="warning">注意（4-7日）</option>
                        <option value="critical">要注意（1-3日）</option>
                        <option value="expired">期限切れ</option>
                    </select>
                </div>

                <button id="clearFiltersBtn" class="btn btn-secondary" aria-label="フィルターをクリア">
                    クリア
                </button>
            </div>
        </section>

        <!-- Main Content: Gantt Chart -->
        <main class="main-content">
            <div id="ganttContainer" class="gantt-container">
                <div class="gantt-header">
                    <div class="gantt-label-column">
                        <div class="gantt-label-header">アイテム</div>
                    </div>
                    <div class="gantt-timeline-column">
                        <div id="timelineHeader" class="timeline-header">
                            <!-- Timeline dates will be generated by JavaScript -->
                        </div>
                    </div>
                </div>
                <div id="ganttBody" class="gantt-body">
                    <!-- Ingredient rows will be generated by JavaScript -->
                    <div class="empty-state" id="emptyState">
                        <p class="empty-state-text">まだアイテムが登録されていません</p>
                        <p class="empty-state-hint">右下の「＋」ボタンから登録してください</p>
                    </div>
                </div>
            </div>
        </main>

        <!-- FAB (Floating Action Button) -->
        <button id="fabAddBtn" class="fab" aria-label="アイテムを追加">
            <span class="fab-icon">+</span>
        </button>

        <!-- Modal: Add/Edit Ingredient Form -->
        <div id="ingredientModal" class="modal" role="dialog" aria-labelledby="modalTitle" aria-hidden="true">
            <div class="modal-overlay" id="modalOverlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2 id="modalTitle" class="modal-title">アイテムを追加</h2>
                    <button id="closeModalBtn" class="btn-close" aria-label="閉じる">&times;</button>
                </div>

                <form id="ingredientForm" class="ingredient-form">
                    <input type="hidden" id="ingredientId" name="id">

                    <div class="form-group">
                        <label for="ingredientName" class="form-label">名前 <span class="required">*</span></label>
                        <input
                            type="text"
                            id="ingredientName"
                            name="name"
                            class="form-input"
                            required
                            placeholder="例: チョコレート"
                            autocomplete="off"
                        >
                        <span class="form-error" id="nameError"></span>
                    </div>

                    <div class="form-group">
                        <label for="ingredientCategory" class="form-label">カテゴリー <span class="required">*</span></label>
                        <select id="ingredientCategory" name="category" class="form-select" required>
                            <option value="">選択してください</option>
                            <option value="お菓子">お菓子</option>
                            <option value="肉類">肉類</option>
                            <option value="魚介類">魚介類</option>
                            <option value="乳製品・卵">乳製品・卵</option>
                            <option value="野菜">野菜</option>
                            <option value="果物">果物</option>
                            <option value="穀物・麺類">穀物・麺類</option>
                            <option value="缶詰">缶詰</option>
                            <option value="調味料">調味料</option>
                            <option value="飲料">飲料</option>
                            <option value="その他">その他</option>
                        </select>
                        <span class="form-error" id="categoryError"></span>
                    </div>

                    <div class="form-group">
                        <label for="expirationDate" class="form-label">賞味期限 <span class="required">*</span></label>
                        <input
                            type="date"
                            id="expirationDate"
                            name="expirationDate"
                            class="form-input"
                            required
                        >
                        <span class="form-error" id="expirationDateError"></span>
                    </div>

                    <div class="form-group">
                        <label for="location" class="form-label">保管場所</label>
                        <input
                            type="text"
                            id="location"
                            name="location"
                            class="form-input"
                            placeholder="例: 冷蔵庫"
                        >
                    </div>

                    <div class="form-group">
                        <label for="notes" class="form-label">メモ</label>
                        <textarea
                            id="notes"
                            name="notes"
                            class="form-textarea"
                            rows="3"
                            placeholder="例: 炒め物用"
                        ></textarea>
                    </div>

                    <div class="form-actions">
                        <button type="button" id="cancelBtn" class="btn btn-secondary">キャンセル</button>
                        <button type="submit" id="submitBtn" class="btn btn-primary">保存</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Toast Notification -->
        <div id="toast" class="toast" role="alert" aria-live="polite" aria-atomic="true">
            <span id="toastMessage"></span>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

    <!-- JavaScript Files -->
    <script src="js/firebase.js"></script>
    <script src="js/storage.js" defer></script>
    <script src="js/dataModel.js" defer></script>
    <script src="js/ganttChart.js" defer></script>
    <script src="js/ingredientForm.js" defer></script>
    <script src="js/search.js" defer></script>
    <script src="js/app.js" defer></script>
</body>
</html>
